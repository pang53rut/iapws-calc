<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Voting Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        [x-cloak] {
            display: none !important;
        }

        /* Custom Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                transform: translateX(-50px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(50px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.02);
            }
        }

        @keyframes float {
            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.6s ease forwards;
        }

        .animate-slideInLeft {
            animation: slideInLeft 0.5s ease forwards;
        }

        .animate-slideInRight {
            animation: slideInRight 0.5s ease forwards;
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-pulse-hover:hover {
            animation: pulse 0.8s ease infinite;
        }

        /* Glassmorphism Effect */
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(45deg, #5a67d8, #6b46c1);
        }

        /* Gradient Backgrounds */
        .gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .gradient-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .gradient-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .gradient-dark {
            background: linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
        }

        .gradient-accent {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        /* Card Effects */
        .card-hover {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card-hover:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        /* Enhanced Sidebar */
        .sidebar {
            background: linear-gradient(180deg, #1e40af 0%, #1e3a8a 50%, #312e81 100%);
            position: relative;
            overflow: hidden;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .sidebar-item {
            position: relative;
            overflow: hidden;
            margin: 0 12px 8px;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .sidebar-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .sidebar-item:hover::before {
            opacity: 1;
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .sidebar-item.active::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #fbbf24, #f59e0b);
            border-radius: 0 4px 4px 0;
        }

        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.4);
        }

        /* Loading Animation */
        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Enhanced Stats Cards */
        .stats-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.4s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border-color: rgba(99, 102, 241, 0.3);
        }

        /* Profile Card */
        .profile-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            position: relative;
            overflow: hidden;
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
        }

        /* Candidate Cards */
        .candidate-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .candidate-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .candidate-card:hover::before {
            opacity: 1;
        }

        .candidate-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        /* Chart styling */
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 12px;
            padding: 20px;
        }

        /* Table styling */
        .table-row {
            transition: all 0.2s ease;
        }

        .table-row:hover {
            background: linear-gradient(90deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
            transform: scale(1.01);
        }

        /* Progress bars */
        .progress-bar {
            background: linear-gradient(90deg, #e5e7eb, #f3f4f6);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            transform: translateX(-100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-50 to-blue-50" x-data="votingApp()" x-init="init()">

    <div x-show="loading" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50" x-cloak>
        <div class="glass rounded-3xl p-10 flex flex-col items-center space-y-6 animate-pulse">
            <div class="loader"></div>
            <div class="text-white font-semibold text-lg">Memproses...</div>
            <div class="w-32 h-1 bg-white bg-opacity-20 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-blue-400 to-purple-500 rounded-full animate-pulse"></div>
            </div>
        </div>
    </div>

    <div x-show="currentPage === 'landing'" class="min-h-screen gradient-primary flex flex-col relative overflow-hidden"
        x-cloak>
        <div class="absolute inset-0 overflow-hidden">
            <div class="absolute -top-4 -right-4 w-72 h-72 bg-white bg-opacity-10 rounded-full animate-float"></div>
            <div class="absolute top-1/2 -left-8 w-48 h-48 bg-white bg-opacity-5 rounded-full animate-float"
                style="animation-delay: -1s"></div>
            <div class="absolute bottom-1/4 right-1/4 w-32 h-32 bg-white bg-opacity-10 rounded-full animate-float"
                style="animation-delay: -2s"></div>
        </div>

        <div class="container mx-auto px-6 py-12 flex-grow flex flex-col justify-center relative z-10">
            <div class="text-center text-white mb-16 animate-fadeIn">
                <h1
                    class="text-5xl md:text-7xl font-black mb-6 drop-shadow-2xl bg-gradient-to-r from-white to-blue-100 bg-clip-text text-transparent">
                    Voting Digital
                </h1>
                <p class="text-xl md:text-2xl opacity-90 max-w-3xl mx-auto font-light leading-relaxed">
                    Platform voting revolusioner dengan teknologi terdepan untuk
                    demokrasi yang transparan dan modern
                </p>
            </div>

            <div class="max-w-7xl mx-auto grid md:grid-cols-3 gap-8 mb-16">
                <div class="glass rounded-3xl p-8 text-center text-white card-hover animate-slideInLeft"
                    style="animation-delay: 0.2s">
                    <div
                        class="w-24 h-24 bg-gradient-to-br from-white/20 to-white/10 rounded-2xl flex items-center justify-center mx-auto mb-6 animate-float">
                        <i data-lucide="shield-check" class="w-12 h-12"></i>
                    </div>
                    <h3 class="text-2xl font-bold mb-4">Keamanan Tinggi</h3>
                    <p class="opacity-80 leading-relaxed">Sistem enkripsi berlapis dan autentifikasi multi-faktor untuk
                        perlindungan maksimal</p>
                </div>

                <div class="glass rounded-3xl p-8 text-center text-white card-hover animate-fadeIn"
                    style="animation-delay: 0.4s">
                    <div class="w-24 h-24 bg-gradient-to-br from-white/20 to-white/10 rounded-2xl flex items-center justify-center mx-auto mb-6 animate-float"
                        style="animation-delay: -1s">
                        <i data-lucide="bar-chart-3" class="w-12 h-12"></i>
                    </div>
                    <h3 class="text-2xl font-bold mb-4">Analytics Real-time</h3>
                    <p class="opacity-80 leading-relaxed">Dashboard interaktif dengan visualisasi data yang memukau dan
                        laporan komprehensif</p>
                </div>

                <div class="glass rounded-3xl p-8 text-center text-white card-hover animate-slideInRight"
                    style="animation-delay: 0.6s">
                    <div class="w-24 h-24 bg-gradient-to-br from-white/20 to-white/10 rounded-2xl flex items-center justify-center mx-auto mb-6 animate-float"
                        style="animation-delay: -2s">
                        <i data-lucide="smartphone" class="w-12 h-12"></i>
                    </div>
                    <h3 class="text-2xl font-bold mb-4">Mobile-First</h3>
                    <p class="opacity-80 leading-relaxed">Responsive design yang sempurna di semua perangkat dengan
                        performa optimal</p>
                </div>
            </div>

            <div class="text-center animate-fadeIn" style="animation-delay: 0.8s">
                <button @click="currentPage = 'login'"
                    class="group btn-primary text-white px-12 py-5 rounded-full font-bold text-xl shadow-2xl animate-pulse-hover relative overflow-hidden">
                    <span class="relative z-10 flex items-center">
                        <i data-lucide="arrow-right"
                            class="w-6 h-6 mr-3 transition-transform group-hover:translate-x-1"></i>
                        Mulai Voting Sekarang
                    </span>
                </button>
            </div>
        </div>

        <footer class="py-8 text-center text-white text-opacity-70 relative z-10">
            <p class="text-lg font-light">© <span x-text="new Date().getFullYear()"></span> Sistem Voting Digital.
                Semua hak dilindungi.</p>
        </footer>
    </div>

    <div x-show="currentPage === 'login'"
        class="min-h-screen gradient-dark flex items-center justify-center px-6 relative overflow-hidden" x-cloak>
        <div class="absolute inset-0">
            <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-blue-500 bg-opacity-10 rounded-full blur-3xl animate-pulse">
            </div>
            <div class="absolute bottom-1/4 right-1/4 w-48 h-48 bg-purple-500 bg-opacity-10 rounded-full blur-3xl animate-pulse"
                style="animation-delay: -1s"></div>
        </div>

        <div class="glass rounded-3xl shadow-2xl p-10 w-full max-w-md animate-fadeIn relative z-10">
            <div class="text-center mb-10">
                <div
                    class="w-24 h-24 bg-gradient-to-br from-white/20 to-white/10 rounded-2xl flex items-center justify-center mx-auto mb-6 overflow-hidden">
                    <img src="https://cdn-icons-png.freepik.com/512/9809/9809609.png" alt="Logo Aplikasi"
                        class="w-full h-full object-cover p-2">
                </div>
                <h2 class="text-4xl font-bold text-white mb-3">Selamat Datang</h2>
                <p class="text-white text-opacity-80 text-lg">Masuk ke akun voting Anda</p>
            </div>

            <form @submit.prevent="login()" class="space-y-6">

                <div>
                    <label class="block text-white text-opacity-90 text-sm font-semibold mb-3">Email Address</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
                            <i data-lucide="mail" class="w-5 h-5 text-white text-opacity-70"></i>
                        </div>
                        <input type="email" x-model="loginForm.email" required
                            class="w-full pl-12 pr-4 py-4 bg-white bg-opacity-10 border border-white border-opacity-20 rounded-xl text-white placeholder-white placeholder-opacity-50 focus:ring-2 focus:ring-white focus:ring-opacity-50 focus:border-transparent transition-all duration-300"
                            placeholder="masukkan@email.com">
                    </div>
                </div>

                <div>
                    <label class="block text-white text-opacity-90 text-sm font-semibold mb-3">Password</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
                            <i data-lucide="lock" class="w-5 h-5 text-white text-opacity-70"></i>
                        </div>
                        <input type="password" x-model="loginForm.password" required
                            class="w-full pl-12 pr-4 py-4 bg-white bg-opacity-10 border border-white border-opacity-20 rounded-xl text-white placeholder-white placeholder-opacity-50 focus:ring-2 focus:ring-white focus:ring-opacity-50 focus:border-transparent transition-all duration-300"
                            placeholder="••••••••">
                    </div>
                </div>

                <div x-show="loginError"
                    class="p-4 bg-red-500 bg-opacity-20 border border-red-400 border-opacity-30 text-white rounded-xl animate-fadeIn"
                    x-cloak>
                    <div class="flex items-center">
                        <i data-lucide="alert-circle" class="w-5 h-5 mr-3 flex-shrink-0"></i>
                        <span x-text="loginError"></span>
                    </div>
                </div>

                <button type="submit" :disabled="loading"
                    class="w-full btn-primary text-white font-bold py-4 px-6 rounded-xl disabled:opacity-50 flex items-center justify-center text-lg">
                    <span x-show="!loading" class="flex items-center">
                        <i data-lucide="log-in" class="w-5 h-5 mr-3"></i>
                        Masuk ke Dashboard
                    </span>
                    <span x-show="loading" class="flex items-center">
                        <div class="loader w-5 h-5 mr-3"></div>
                        Memverifikasi...
                    </span>
                </button>
            </form>

            <div class="mt-8 text-center">
                <button @click="currentPage = 'landing'"
                    class="text-white text-opacity-80 hover:text-opacity-100 flex items-center justify-center mx-auto transition-all duration-300 group">
                    <i data-lucide="arrow-left"
                        class="w-4 h-4 mr-2 transition-transform group-hover:-translate-x-1"></i>
                    Kembali ke beranda
                </button>
            </div>
        </div>
    </div>

    <div x-show="currentPage === 'dashboard'"
        class="relative md:h-screen md:overflow-hidden md:flex bg-gradient-to-br from-slate-50 to-blue-50" x-cloak>

        <div @click="isSidebarOpen = false" x-show="isSidebarOpen"
            class="fixed inset-0 bg-black opacity-50 z-20 md:hidden"></div>

        <div class="w-72 sidebar flex flex-col shadow-2xl fixed inset-y-0 left-0 z-30 transform
transition-transform duration-300 md:relative md:translate-x-0"
            :class="isSidebarOpen ? 'translate-x-0' : '-translate-x-full'">
            <div class="p-6 border-b border-white border-opacity-20">
                <div class="flex items-center">
                    <div
                        class="w-14 h-14 gradient-accent rounded-xl flex items-center justify-center mr-4 shadow-lg">
                        <i data-lucide="vote" class="w-7 h-7 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">Voting System</h1>
                        <p class="text-sm text-blue-200 font-medium"
                            x-text="user.role === 'admin' ? 'Administrator Panel' : 'Voter Dashboard'"></p>
                    </div>
                </div>
            </div>

            <nav class="mt-8 flex-grow px-3">
                <a @click="activeSection = 'dashboard'; isSidebarOpen = false"
                    class="sidebar-item flex items-center px-5 py-4 text-white/90 hover:text-white cursor-pointer font-medium text-sm"
                    :class="activeSection === 'dashboard' ? 'active text-white' : ''">
                    <i data-lucide="home" class="w-5 h-5 mr-4"></i>
                    <span>Dashboard</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto transition-transform"
                        :class="activeSection === 'dashboard' ? 'rotate-90' : ''"></i>
                </a>

                <a @click="activeSection = 'voting'; isSidebarOpen = false"
                    class="sidebar-item flex items-center px-5 py-4 text-white/90 hover:text-white cursor-pointer font-medium text-sm"
                    :class="activeSection === 'voting' ? 'active text-white' : ''">
                    <i data-lucide="vote" class="w-5 h-5 mr-4"></i>
                    <span>E-Voting</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto transition-transform"
                        :class="activeSection === 'voting' ? 'rotate-90' : ''"></i>
                </a>

                <a x-show="user.role === 'admin'" @click="activeSection = 'candidates'; isSidebarOpen = false"
                    class="sidebar-item flex items-center px-5 py-4 text-white/90 hover:text-white cursor-pointer font-medium text-sm"
                    :class="activeSection === 'candidates' ? 'active text-white' : ''">
                    <i data-lucide="users" class="w-5 h-5 mr-4"></i>
                    <span>Kelola Kandidat</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto transition-transform"
                        :class="activeSection === 'candidates' ? 'rotate-90' : ''"></i>
                </a>

                <a x-show="user.role === 'admin'" @click="activeSection = 'users'; isSidebarOpen = false"
                    class="sidebar-item flex items-center px-5 py-4 text-white/90 hover:text-white cursor-pointer font-medium text-sm"
                    :class="activeSection === 'users' ? 'active text-white' : ''">
                    <i data-lucide="users-2" class="w-5 h-5 mr-4"></i>
                    <span>Kelola Pengguna</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto transition-transform"
                        :class="activeSection === 'users' ? 'rotate-90' : ''"></i>
                </a>

                <a x-show="user.role === 'admin'" @click="activeSection = 'results'; isSidebarOpen = false"
                    class="sidebar-item flex items-center px-5 py-4 text-white/90 hover:text-white cursor-pointer font-medium text-sm"
                    :class="activeSection === 'results' ? 'active text-white' : ''">
                    <i data-lucide="bar-chart-3" class="w-5 h-5 mr-4"></i>
                    <span>Hasil & Analytics</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto transition-transform"
                        :class="activeSection === 'results' ? 'rotate-90' : ''"></i>
                </a>

                <a @click="activeSection = 'profile'; isSidebarOpen = false"
                    class="sidebar-item flex items-center px-5 py-4 text-white/90 hover:text-white cursor-pointer font-medium text-sm"
                    :class="activeSection === 'profile' ? 'active text-white' : ''">
                    <i data-lucide="user" class="w-5 h-5 mr-4"></i>
                    <span>Profil Saya</span>
                    <i data-lucide="chevron-right" class="w-4 h-4 ml-auto transition-transform"
                        :class="activeSection === 'profile' ? 'rotate-90' : ''"></i>
                </a>
            </nav>

            <div class="p-4 border-t border-white border-opacity-20">
                <div class="flex items-center p-3 rounded-xl bg-white bg-opacity-10 mb-3">
                    <div class="w-10 h-10 gradient-accent rounded-lg flex items-center justify-center mr-3">
                        <i data-lucide="user" class="w-5 h-5 text-white"></i>
                    </div>
                    <div class="flex-grow overflow-hidden">
                        <div class="text-white font-medium text-sm truncate" x-text="user.email"></div>
                        <div class="text-blue-200 text-xs capitalize" x-text="user.role"></div>
                    </div>
                </div>


                <button @click="logout()"
                    class="w-full flex items-center px-4 py-3 text-red-300 hover:text-white hover:bg-red-500 hover:bg-opacity-20 rounded-xl cursor-pointer transition-all duration-200 font-medium text-sm">
                    <i data-lucide="log-out" class="w-5 h-5 mr-3"></i>
                    <span>Keluar</span>
                </button>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto">
            <div class="p-4 md:hidden sticky top-0 bg-slate-50/80 backdrop-blur-sm z-10">
                <div class="flex items-center justify-between">
                    <button @click.stop="isSidebarOpen = !isSidebarOpen"
                        class="p-2 rounded-lg bg-gray-200 text-gray-800">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <div class="text-xl font-bold text-gray-700 capitalize" x-text="activeSection"></div>
                    <div class="w-10"></div>
                </div>
            </div>

            <div class="p-4 md:p-8">


                <div x-show="activeSection === 'dashboard'" class="animate-fadeIn space-y-8">
                    <div class="mb-10">
                        <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6">
                            <div>
                                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Dashboard</h2>
                                <p class="text-gray-600 text-lg">Selamat datang kembali, <span
                                        class="font-semibold text-blue-600"
                                        x-text="user.email.split('@')[0]"></span></p>
                            </div>
                            <div class="text-left md:text-right mt-2 md:mt-0">
                                <div class="text-sm text-gray-500">
                                    <span x-text="formatDate(new Date())"></span>
                                </div>
                            </div>
                        </div>

                    </div>


                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                        <div class="stats-card rounded-2xl p-6 shadow-lg border">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Total Kandidat</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2" x-text="candidates.length"></p>
                                    <div class="flex items-center mt-2 text-sm text-green-600">
                                        <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>Stabil</span>
                                    </div>
                                </div>
                                <div
                                    class="w-16 h-16 gradient-primary rounded-2xl flex items-center justify-center shadow-lg">
                                    <i data-lucide="users" class="w-8 h-8 text-white"></i>
                                </div>
                            </div>
                            <div class="mt-4 w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full"
                                    style="width: 100%"></div>
                            </div>
                        </div>



                        <div class="stats-card rounded-2xl p-6 shadow-lg border">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Total Suara</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2" x-text="votes.length"></p>
                                    <div class="flex items-center mt-2 text-sm text-green-600">
                                        <i data-lucide="trending-up" class="w-4 h-4 mr-1"></i>
                                        <span>+12% dari kemarin</span>
                                    </div>
                                </div>
                                <div
                                    class="w-16 h-16 gradient-success rounded-2xl flex items-center justify-center shadow-lg">
                                    <i data-lucide="vote" class="w-8 h-8 text-white"></i>
                                </div>
                            </div>
                            <div class="mt-4 w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-cyan-400 to-blue-500 h-2 rounded-full"
                                    :style="`width: ${Math.min((votes.length / users.length) * 100, 100)}%`"></div>
                            </div>
                        </div>

                        <div class="stats-card rounded-2xl p-6 shadow-lg border">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Status Voting</p>
                                    <p class="text-lg font-semibold mt-2"
                                        :class="userHasVoted ? 'text-green-600' : 'text-orange-600'"
                                        x-text="userHasVoted ? 'Sudah Voting' : 'Belum Voting'"></p>
                                    <div class="flex items-center mt-2 text-sm"
                                        :class="userHasVoted ? 'text-green-600' : 'text-orange-600'">
                                        <i data-lucide="info" class="w-4 h-4 mr-1"></i>
                                        <span x-text="userHasVoted ? 'Terverifikasi' : 'Segera voting'"></span>
                                    </div>
                                </div>

                                <div class="w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg"
                                    :class="userHasVoted ? 'bg-gradient-to-br from-green-400 to-green-600' : 'bg-gradient-to-br from-orange-400 to-red-500'">
                                    <i data-lucide="check-circle" class="w-8 h-8 text-white"></i>
                                </div>



                            </div>
                            <div class="mt-4 w-full bg-gray-200 rounded-full h-2">
                                <div class="h-2 rounded-full"
                                    :class="userHasVoted ? 'bg-gradient-to-r from-green-400 to-green-600' : 'bg-gradient-to-r from-orange-400 to-red-500'"
                                    :style="`width: ${userHasVoted ? '100' : '25'}%`"></div>
                            </div>
                        </div>



                        <div class="stats-card rounded-2xl p-6 shadow-lg border">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-600 text-sm font-medium">Partisipasi</p>
                                    <p class="text-3xl font-bold text-gray-800 mt-2"
                                        x-text="Math.round((votes.length / Math.max(users.length, 1)) * 100) + '%'"></p>
                                    <div class="flex items-center mt-2 text-sm text-blue-600">
                                        <i data-lucide="activity" class="w-4 h-4 mr-1"></i>
                                        <span>Real-time</span>
                                    </div>
                                </div>
                                <div
                                    class="w-16 h-16 gradient-accent rounded-2xl flex items-center justify-center shadow-lg">
                                    <i data-lucide="percent" class="w-8 h-8 text-white"></i>
                                </div>
                            </div>
                            <div class="mt-4 w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-yellow-400 to-orange-500 h-2 rounded-full"
                                    :style="`width: ${Math.round((votes.length / Math.max(users.length, 1)) * 100)}%`">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-1">
                            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                    <i data-lucide="zap" class="w-5 h-5 mr-2 text-yellow-500"></i>
                                    Quick Actions
                                </h3>
                                <div class="space-y-4">
                                    <button @click="activeSection = 'voting'"
                                        class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 rounded-xl border border-blue-200 transition-all duration-300">
                                        <div class="flex items-center">
                                            <i data-lucide="vote" class="w-5 h-5 text-blue-600 mr-3"></i>
                                            <span class="font-medium text-gray-800">Mulai Voting</span>
                                        </div>
                                        <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
                                    </button>


                                    <button @click="activeSection = 'profile'"
                                        class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-cyan-50 hover:from-green-100 hover:to-cyan-100 rounded-xl border border-green-200 transition-all duration-300">
                                        <div class="flex items-center">
                                            <i data-lucide="user" class="w-5 h-5 text-green-600 mr-3"></i>
                                            <span class="font-medium text-gray-800">Lihat Profil</span>
                                        </div>
                                        <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
                                    </button>


                                    <div x-show="user.role === 'admin'">
                                        <button @click="activeSection = 'results'"
                                            class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-pink-50 hover:from-purple-100 hover:to-pink-100 rounded-xl border border-purple-200 transition-all duration-300">
                                            <div class="flex items-center">
                                                <i data-lucide="bar-chart-3"
                                                    class="w-5 h-5 text-purple-600 mr-3"></i>
                                                <span class="font-medium text-gray-800">Analytics</span>
                                            </div>
                                            <i data-lucide="chevron-right" class="w-4 h-4 text-gray-400"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="lg:col-span-2">
                            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                        <i data-lucide="activity" class="w-5 h-5 mr-2 text-green-500"></i>
                                        Aktivitas Terkini
                                    </h3>
                                    <span
                                        class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">Live</span>
                                </div>
                                <div class="space-y-4 max-h-64 overflow-y-auto">
                                    <template x-for="(vote, index) in votes.slice(-5).reverse()" :key="index">
                                        <div
                                            class="flex items-center p-4 hover:bg-gray-50 rounded-xl transition-all duration-200 border border-gray-100">
                                            <div
                                                class="w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-xl flex items-center justify-center mr-4">
                                                <i data-lucide="user-check" class="w-5 h-5 text-blue-600"></i>
                                            </div>
                                            <div class="flex-grow">
                                                <p class="font-semibold text-gray-800"
                                                    x-text="vote.email.split('@')[0]"></p>
                                                <p class="text-sm text-gray-600">Telah melakukan voting</p>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-sm text-gray-500"
                                                    x-text="formatTimeAgo(vote.timestamp)"></div>
                                                <div class="text-xs text-green-600 flex items-center mt-1">
                                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-1"></div>
                                                    Verified
                                                </div>
                                            </div>
                                        </div>
                                    </template>


                                    <div x-show="votes.length === 0" class="text-center py-12">
                                        <div
                                            class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                            <i data-lucide="inbox" class="w-8 h-8 text-gray-400"></i>
                                        </div>
                                        <p class="text-gray-500 font-medium">Belum
                                            ada aktivitas voting</p>
                                        <p class="text-sm text-gray-400 mt-1">Aktivitas akan muncul di sini setelah
                                            voting dimulai</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div x-show="activeSection === 'voting'" class="animate-fadeIn space-y-8">
                    <div class="flex items-center justify-between mb-8">



                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">E-Voting</h2>
                            <p class="text-gray-600 text-lg">Pilih kandidat favorit Anda dengan sekali klik</p>
                        </div>


                        <div class="bg-white rounded-xl px-4 py-2 shadow-lg border">
                            <span class="text-sm text-gray-600">Total Kandidat: </span>
                            <span class="font-bold text-blue-600" x-text="candidates.length"></span>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-8 space-y-8">

                        <div x-show="userHasVoted"
                            class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-2xl p-6 animate-fadeIn">



                            <div class="flex items-start">
                                <div
                                    class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                    <i data-lucide="check-circle" class="w-6 h-6 text-white"></i>


                                </div>
                                <div>
                                    <h4 class="text-lg font-bold text-green-800 mb-1">Voting Berhasil!</h4>
                                    <p class="text-green-700 mb-2">Terima kasih telah berpartisipasi dalam pemilihan
                                        ini.</p>
                                    <p class="text-sm text-green-600">Setiap pemilih hanya dapat melakukan voting satu
                                        kali untuk menjaga integritas sistem.</p>
                                </div>
                            </div>
                        </div>


                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">


                            <template x-for="candidate in candidates" :key="candidate.id">
                                <div
                                    class="candidate-card rounded-2xl shadow-lg border border-gray-200 overflow-hidden group">
                                    <div class="relative overflow-hidden">



                                        <img :src="candidate.foto || 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=250&fit=crop'"
                                            :alt="candidate.nama"
                                            class="w-full h-56 object-cover transition-transform duration-500 group-hover:scale-110">
                                        <div
                                            class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 group-hover:opacity-70 transition-all duration-300">
                                        </div>


                                        <div
                                            class="absolute bottom-0 left-0 right-0 p-4 text-white transform translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                                            <p class="text-sm font-medium">Kandidat ID: <span class="font-bold"
                                                    x-text="candidate.id"></span></p>


                                        </div>
                                        <div
                                            class="absolute top-4 right-4 bg-white bg-opacity-90 text-gray-800 px-3 py-1 rounded-full text-sm font-bold">


                                            #<span x-text="candidate.id"></span>


                                        </div>
                                    </div>

                                    <div class="p-6">

                                        <h3 class="text-2xl font-bold text-gray-800 mb-3" x-text="candidate.nama"></h3>
                                        <p class="text-gray-600 mb-6 h-20 overflow-hidden line-clamp-3 leading-relaxed"
                                            x-text="candidate.deskripsi"></p>



                                        <button @click="vote(candidate.id)" :disabled="userHasVoted || loading"
                                            class="w-full py-4 px-6 rounded-xl font-bold transition-all duration-300 flex items-center justify-center text-lg"
                                            :class="userHasVoted ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'btn-primary text-white transform hover:scale-105'">

                                            <i data-lucide="check-square" class="w-5 h-5 mr-3"></i>
                                            <span x-show="!userHasVoted">Pilih Kandidat</span>


                                            <span x-show="userHasVoted">Sudah Memilih</span>
                                        </button>



                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>



                <div x-show="activeSection === 'candidates' && user.role === 'admin'"
                    class="animate-fadeIn space-y-8">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8">


                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Kelola Kandidat</h2>
                            <p class="text-gray-600 text-lg">Tambah, edit, atau hapus kandidat pemilihan</p>


                        </div>
                        <button @click="showAddCandidate = true"
                            class="mt-4 lg:mt-0 btn-primary text-white px-8 py-4 rounded-xl flex items-center text-lg font-bold shadow-lg">
                            <i data-lucide="plus-circle" class="w-5 h-5 mr-3"></i>
                            Tambah Kandidat Baru
                        </button>
                    </div>


                    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200">

                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <i data-lucide="users" class="w-5 h-5 mr-2"></i>
                                Daftar Kandidat
                            </h3>
                        </div>

                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">


                                    <tr>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Foto</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            ID</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Nama Kandidat</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Deskripsi</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Aksi</th>
                                    </tr>
                                </thead>


                                <tbody class="divide-y divide-gray-200">
                                    <template x-for="candidate in candidates" :key="candidate.id">
                                        <tr
                                            class="table-row hover:bg-gradient-to-r hover:from-blue-50 hover:to-purple-50">
                                            <td class="px-6 py-4">



                                                <img :src="candidate.foto || 'https://via.placeholder.com/60x60'"
                                                    class="w-16 h-16 rounded-xl object-cover shadow-md border-2 border-white">



                                            </td>
                                            <td class="px-6 py-4">
                                                <span
                                                    class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-bold"
                                                    x-text="'#' + candidate.id"></span>
                                            </td>
                                            <td class="px-6 py-4 font-bold text-gray-800" x-text="candidate.nama"></td>
                                            <td class="px-6 py-4 text-gray-600 max-w-xs">


                                                <div class="truncate" x-text="candidate.deskripsi"></div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="flex items-center space-x-3">
                                                    <button @click="openEditModal(candidate)"
                                                        class="p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors duration-200">
                                                        <i data-lucide="edit-3" class="w-5 h-5"></i>
                                                    </button>
                                                    <button @click="deleteCandidate(candidate.id)"
                                                        class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors duration-200">
                                                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>



                                    <tr x-show="candidates.length === 0">
                                        <td colspan="5" class="px-6 py-12 text-center">
                                            <div
                                                class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                                <i data-lucide="users" class="w-8 h-8 text-gray-400"></i>
                                            </div>
                                            <p class="text-gray-500 font-medium">Belum ada data kandidat</p>
                                            <p class="text-sm text-gray-400 mt-1">Tambahkan kandidat pertama untuk
                                                memulai</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div x-show="activeSection === 'users' && user.role === 'admin'" class="animate-fadeIn space-y-8">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8">
                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Kelola Pengguna</h2>
                            <p class="text-gray-600 text-lg">Tambah, edit, atau hapus data pemilih dan admin</p>
                        </div>
                        <button @click="openAddUserModal()"
                            class="mt-4 lg:mt-0 btn-primary text-white px-8 py-4 rounded-xl flex items-center text-lg font-bold shadow-lg">
                            <i data-lucide="user-plus" class="w-5 h-5 mr-3"></i>
                            Tambah Pengguna Baru
                        </button>
                    </div>

                    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-800 flex items-center">
                                <i data-lucide="users-2" class="w-5 h-5 mr-2"></i>
                                Daftar Pengguna Terdaftar
                            </h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Email</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Role</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Status Voting</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Aksi</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <template x-for="u in users" :key="u.email">
                                        <tr class="table-row">
                                            <td class="px-6 py-4 font-medium text-gray-800" x-text="u.email"></td>
                                            <td class="px-6 py-4">
                                                <span class="px-3 py-1 rounded-full text-sm font-bold"
                                                    :class="u.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'"
                                                    x-text="u.role"></span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="flex items-center text-sm font-semibold"
                                                    :class="votes.some(v => v.email === u.email) ? 'text-green-600' : 'text-gray-500'">
                                                    <i data-lucide="circle" class="w-3 h-3 mr-2"
                                                        :class="votes.some(v => v.email === u.email) ? 'fill-current' : ''"></i>
                                                    <span
                                                        x-text="votes.some(v => v.email === u.email) ? 'Sudah Voting' : 'Belum Voting'"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="flex items-center space-x-3">
                                                    <button @click="openEditUserModal(u)"
                                                        class="p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors duration-200">
                                                        <i data-lucide="edit-3" class="w-5 h-5"></i>
                                                    </button>
                                                    <button @click="deleteUser(u.email)" :disabled="u.email === user.email"
                                                        class="p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors duration-200 disabled:opacity-30 disabled:cursor-not-allowed">
                                                        <i data-lucide="trash-2" class="w-5 h-5"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                    <tr x-show="users.length === 0">
                                        <td colspan="4" class="px-6 py-12 text-center">
                                            <div
                                                class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                                <i data-lucide="user-x" class="w-8 h-8 text-gray-400"></i>
                                            </div>
                                            <p class="text-gray-500 font-medium">Belum ada data pengguna</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


                <div x-show="activeSection === 'results' && user.role === 'admin'" class="animate-fadeIn space-y-8">
                    <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-8">

                        <div>
                            <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Hasil & Analytics</h2>
                            <p class="text-gray-600 text-lg">Dashboard analisis voting dengan visualisasi real-time</p>

                        </div>
                        <button @click="resetVotes()"
                            class="mt-4 lg:mt-0 btn-danger text-white px-8 py-4 rounded-xl flex items-center text-lg font-bold shadow-lg">
                            <i data-lucide="refresh-cw" class="w-5 h-5 mr-3"></i>
                            Reset Semua Data
                        </button>
                    </div>


                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

                        <div class="stats-card rounded-2xl p-6 shadow-lg border">
                            <div class="flex items-center justify-between mb-4">
                                <div
                                    class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl flex items-center justify-center">
                                    <i data-lucide="users" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-gray-800" x-text="users.length"></div>
                                    <div class="text-sm text-gray-600">Total Pemilih</div>
                                </div>


                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-400 to-blue-600 h-2 rounded-full"
                                    style="width: 100%"></div>



                            </div>
                        </div>


                        <div class="stats-card rounded-2xl p-6 shadow-lg border">

                            <div class="flex items-center justify-between mb-4">
                                <div
                                    class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-xl flex items-center justify-center">
                                    <i data-lucide="vote" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-gray-800" x-text="votes.length"></div>
                                    <div class="text-sm text-gray-600">Total Voting</div>
                                </div>


                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-green-400 to-green-600 h-2 rounded-full"
                                    :style="`width: ${Math.min((votes.length / users.length) * 100, 100)}%`"></div>
                            </div>
                        </div>


                        <div class="stats-card rounded-2xl p-6 shadow-lg border">

                            <div class="flex items-center justify-between mb-4">
                                <div
                                    class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl flex items-center justify-center">
                                    <i data-lucide="percent" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-gray-800"
                                        x-text="Math.round((votes.length / Math.max(users.length, 1)) * 100) + '%'">
                                    </div>
                                    <div class="text-sm text-gray-600">Partisipasi</div>
                                </div>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-purple-400 to-purple-600 h-2 rounded-full"
                                    :style="`width: ${Math.round((votes.length / Math.max(users.length, 1)) * 100)}%`">
                                </div>
                            </div>
                        </div>


                        <div class="stats-card rounded-2xl p-6 shadow-lg border">
                            <div class="flex items-center justify-between mb-4">
                                <div
                                    class="w-12 h-12 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl flex items-center justify-center">
                                    <i data-lucide="award" class="w-6 h-6 text-white"></i>
                                </div>
                                <div class="text-right">

                                    <div class="text-lg font-bold text-gray-800 truncate"
                                        x-text="votingResults.length > 0 ? votingResults[0].nama : 'Belum Ada'"></div>

                                    <div class="text-sm text-gray-600">Kandidat Teratas</div>
                                </div>



                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-gradient-to-r from-yellow-400 to-orange-500 h-2 rounded-full"
                                    :style="`width: ${votingResults.length > 0 ? votingResults[0].percentage : 0}%`">
                                </div>

                            </div>
                        </div>
                    </div>



                    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
                        <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-b border-gray-200">
                            <h3 class="text-xl font-bold text-gray-800 flex items-center">
                                <i data-lucide="bar-chart-3" class="w-5 h-5 mr-2"></i>
                                Tabel Hasil Voting
                            </h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Ranking</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Kandidat</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Suara</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Persentase</th>
                                        <th
                                            class="px-6 py-4 text-left text-xs font-bold text-gray-600 uppercase tracking-wider">
                                            Progress</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    <template x-for="(result, index) in votingResults" :key="result.id">
                                        <tr class="table-row">
                                            <td class="px-6 py-6">
                                                <div class="flex items-center">
                                                    <div class="w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg"
                                                        :class="index === 0 ? 'bg-gradient-to-br from-yellow-400 to-yellow-600' : 
                                                                index === 1 ? 'bg-gradient-to-br from-gray-400 to-gray-600' : 
                                                                index === 2 ? 'bg-gradient-to-br from-orange-600 to-orange-800' : 
                                                                'bg-gradient-to-br from-blue-400 to-blue-600'"
                                                        x-text="index + 1"></div>
                                                    <div x-show="index < 3" class="ml-2">
                                                        <i :class="index === 0 ? 'text-yellow-500' : index === 1 ? 'text-gray-500' : 'text-orange-600'"
                                                            data-lucide="award" class="w-5 h-5"></i>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-6">
                                                <div class="flex items-center">
                                                    <div class="font-bold text-gray-800 text-lg" x-text="result.nama">
                                                    </div>
                                                    <div x-show="index === 0"
                                                        class="ml-2 bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-bold">
                                                        Leader
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-6">
                                                <div class="flex items-center">
                                                    <span class="text-2xl font-bold text-gray-800"
                                                        x-text="result.votes"></span>
                                                    <span class="text-sm text-gray-500 ml-2">suara</span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-6">
                                                <div class="flex items-center">
                                                    <span class="text-xl font-bold"
                                                        :class="index === 0 ? 'text-green-600' : 'text-gray-700'"
                                                        x-text="result.percentage + '%'"></span>
                                                </div>
                                            </td>
                                            <td class="px-6 py-6">
                                                <div class="w-full bg-gray-200 rounded-full h-3 progress-bar">
                                                    <div class="h-3 rounded-full transition-all duration-1000 ease-out"
                                                        :class="index === 0 ? 'bg-gradient-to-r from-green-400 to-green-600' : 
                                                                index === 1 ? 'bg-gradient-to-r from-blue-400 to-blue-600' : 
                                                                index === 2 ? 'bg-gradient-to-r from-purple-400 to-purple-600' : 
                                                                'bg-gradient-to-r from-gray-400 to-gray-600'"
                                                        :style="`width: ${result.percentage}%`"></div>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>


                                    <tr x-show="votingResults.length === 0">
                                        <td colspan="5" class="px-6 py-12 text-center">
                                            <div
                                                class="w-16 h-16 bg-gray-100 rounded-2xl flex items-center justify-center mx-auto mb-4">
                                                <i data-lucide="bar-chart-3" class="w-8 h-8 text-gray-400"></i>
                                            </div>
                                            <p class="text-gray-500 font-medium">Belum ada data voting</p>
                                            <p class="text-sm text-gray-400 mt-1">Data akan muncul setelah voting
                                                dimulai</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>


                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">Grafik Batang</h3>
                                <div class="flex items-center text-sm text-gray-500">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                    Live Data
                                </div>
                            </div>
                            <div class="space-y-4">
                                <template x-for="(result, index) in votingResults" :key="result.id">
                                    <div class="w-full">
                                        <div class="flex justify-between items-center mb-1">
                                            <span class="text-sm font-semibold text-gray-700" x-text="result.nama"></span>
                                            <span class="text-sm font-bold text-gray-600" x-text="`${result.votes} suara (${result.percentage}%)`"></span>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-4 progress-bar">
                                            <div class="h-4 rounded-full transition-all duration-1000 ease-out"
                                                :class="{
                                                    'bg-gradient-to-r from-green-400 to-green-600': index === 0,
                                                    'bg-gradient-to-r from-blue-400 to-blue-600': index === 1,
                                                    'bg-gradient-to-r from-purple-400 to-purple-600': index === 2,
                                                    'bg-gradient-to-r from-gray-400 to-gray-600': index > 2
                                                }"
                                                :style="`width: ${result.percentage}%`">
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                <div x-show="votingResults.length === 0" class="text-center py-8">
                                    <p class="text-gray-500">Data belum tersedia.</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold text-gray-800">Grafik Lingkaran</h3>
                                <div class="flex items-center text-sm text-gray-500">
                                    <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                                    Persentase
                                </div>
                            </div>
                            <div class="flex flex-col md:flex-row items-center justify-center gap-8">
                                <div x-show="votes.length > 0" class="relative w-48 h-48">
                                    <div class="absolute inset-0 rounded-full" :style="pieChartStyle()"></div>
                                    <div class="absolute inset-2 bg-white rounded-full flex items-center justify-center">
                                        <span class="text-2xl font-bold text-gray-700" x-text="`${votes.length > 0 ? '100%' : '0%'}`"></span>
                                    </div>
                                </div>
                                <div x-show="votes.length === 0" class="w-48 h-48 bg-gray-100 rounded-full flex items-center justify-center">
                                    <i data-lucide="pie-chart" class="w-16 h-16 text-gray-300"></i>
                                </div>
                                <div class="flex-grow">
                                    <div class="space-y-2">
                                        <template x-for="(result, index) in votingResults" :key="result.id">
                                            <div class="flex items-center justify-between text-sm">
                                                <div class="flex items-center">
                                                    <div class="w-3 h-3 rounded-full mr-2"
                                                        :class="{
                                                            'bg-green-500': index === 0,
                                                            'bg-blue-500': index === 1,
                                                            'bg-purple-500': index === 2,
                                                            'bg-gray-500': index > 2
                                                        }">
                                                    </div>
                                                    <span class="font-medium text-gray-600" x-text="result.nama"></span>
                                                </div>
                                                <span class="font-bold text-gray-800" x-text="result.percentage + '%'"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>


                <div x-show="activeSection === 'profile'" class="animate-fadeIn space-y-8">
                    <div class="mb-8">
                        <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Profil Saya</h2>
                        <p class="text-gray-600 text-lg">Kelola informasi akun dan preferensi Anda</p>
                    </div>


                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2">
                            <div class="profile-card bg-white rounded-2xl shadow-lg border border-gray-200 p-8">
                                <div class="flex flex-col md:flex-row items-center mb-8">
                                    <div
                                        class="w-24 h-24 gradient-primary rounded-2xl flex items-center justify-center mb-4 md:mb-0 md:mr-6 shadow-lg">
                                        <i data-lucide="user" class="w-12 h-12 text-white"></i>
                                    </div>
                                    <div class="text-center md:text-left flex-grow">
                                        <h3 class="text-3xl font-bold text-gray-800 mb-2 break-all" x-text="user.email">
                                        </h3>
                                        <p class="text-gray-600 capitalize text-lg mb-3" x-text="user.role"></p>
                                        <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold shadow-md"
                                            :class="user.role === 'admin' ? 'bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 border border-purple-200' : 'bg-gradient-to-r from-blue-100 to-cyan-100 text-blue-800 border border-blue-200'">

                                            <i data-lucide="shield-check" class="w-4 h-4 mr-2"></i>
                                            <span x-text="user.role === 'admin' ? 'Administrator' : 'Voter'"></span>

                                        </div>
                                    </div>
                                </div>

                                <div class="border-t border-gray-200 pt-8">
                                    <h4 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                                        <i data-lucide="settings" class="w-5 h-5 mr-2"></i>
                                        Informasi Akun
                                    </h4>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div
                                            class="bg-gradient-to-br from-blue-50 to-cyan-50 p-6 rounded-xl border border-blue-200">
                                            <div class="flex items-center mb-3">
                                                <div
                                                    class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                                                    <i data-lucide="mail" class="w-5 h-5 text-white"></i>
                                                </div>


                                                <div>
                                                    <p class="text-sm text-blue-600 font-medium">Email Address</p>
                                                    <p class="font-bold text-gray-800 break-all" x-text="user.email">
                                                    </p>
                                                </div>


                                            </div>
                                        </div>




                                        <div
                                            class="bg-gradient-to-br from-purple-50 to-pink-50 p-6 rounded-xl border border-purple-200">
                                            <div class="flex items-center mb-3">
                                                <div
                                                    class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center mr-3">
                                                    <i data-lucide="crown" class="w-5 h-5 text-white"></i>
                                                </div>


                                                <div>
                                                    <p class="text-sm text-purple-600 font-medium">Role</p>
                                                    <p class="font-bold text-gray-800 capitalize" x-text="user.role">
                                                    </p>
                                                </div>



                                            </div>
                                        </div>





                                        <div
                                            class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                                            <div class="flex items-center mb-3">
                                                <div
                                                    class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                                                    <i data-lucide="check-circle" class="w-5 h-5 text-white"></i>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-green-600 font-medium">Status Voting</p>
                                                    <p class="font-bold"
                                                        :class="userHasVoted ? 'text-green-600' : 'text-orange-600'"
                                                        x-text="userHasVoted ? 'Sudah Voting' : 'Belum Voting'"></p>

                                                </div>
                                            </div>



                                        </div>



                                        <div
                                            class="bg-gradient-to-br from-orange-50 to-yellow-50 p-6 rounded-xl border border-orange-200">
                                            <div class="flex items-center mb-3">
                                                <div
                                                    class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center mr-3">
                                                    <i data-lucide="calendar" class="w-5 h-5 text-white"></i>
                                                </div>
                                                <div>
                                                    <p class="text-sm text-orange-600 font-medium">Login Terakhir</p>
                                                    <p class="font-bold text-gray-800"
                                                        x-text="formatDate(new Date())"></p>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>



                                <div class="border-t border-gray-200 pt-8 mt-8">
                                    <div class="flex flex-col sm:flex-row gap-4">
                                        <button disabled
                                            class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold py-3 px-6 rounded-xl flex items-center justify-center opacity-50 cursor-not-allowed"
                                            title="Fitur akan datang">
                                            <i data-lucide="edit-3" class="w-5 h-5 mr-2"></i>
                                            Edit Profil
                                        </button>

                                        <button @click="openChangePasswordModal()"
                                            class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 flex items-center justify-center">
                                            <i data-lucide="key" class="w-5 h-5 mr-2"></i>
                                            Ganti Password
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <div class="space-y-6">
                            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="history" class="w-5 h-5 mr-2"></i>
                                    Riwayat Aktivitas
                                </h4>
                                <div class="space-y-4">
                                    <div x-show="userHasVoted"
                                        class="flex items-center p-3 bg-green-50 rounded-lg border border-green-200">

                                        <div
                                            class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                                            <i data-lucide="vote" class="w-5 h-5 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-green-800">Voting Selesai</p>
                                            <p class="text-sm text-green-600">Anda telah berpartisipasi dalam pemilihan
                                            </p>
                                        </div>
                                    </div>



                                    <div class="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                                        <div
                                            class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                                            <i data-lucide="log-in" class="w-5 h-5 text-white"></i>
                                        </div>


                                        <div>
                                            <p class="font-medium text-blue-800">Login Berhasil</p>
                                            <p class="text-sm text-blue-600"
                                                x-text="'Hari ini, ' + formatDate(new Date()).split(',')[1]"></p>
                                        </div>

                                    </div>



                                    <div x-show="!userHasVoted"
                                        class="flex items-center p-3 bg-orange-50 rounded-lg border border-orange-200">


                                        <div
                                            class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center mr-3">
                                            <i data-lucide="clock" class="w-5 h-5 text-white"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-orange-800">Menunggu Voting</p>

                                            <p class="text-sm text-orange-600">Silakan lakukan voting Anda</p>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="bg-white rounded-2xl shadow-lg border border-gray-200 p-6">
                                <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                    <i data-lucide="trending-up" class="w-5 h-5 mr-2"></i>
                                    Statistik Cepat
                                </h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center p-2">
                                        <span class="text-gray-600">Login Sessions</span>
                                        <span class="font-bold text-blue-600">1</span>



                                    </div>
                                    <div class="flex justify-between items-center p-2">


                                        <span class="text-gray-600">Votes Cast</span>
                                        <span class="font-bold"
                                            :class="userHasVoted ? 'text-green-600' : 'text-gray-500'"
                                            x-text="userHasVoted ? '1' : '0'"></span>

                                    </div>
                                    <div class="flex justify-between items-center p-2">
                                        <span class="text-gray-600">Account Status</span>
                                        <span class="font-bold text-green-600">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div x-show="showAddCandidate" class="fixed inset-0 bg-black bg-opacity-60 flex
items-center justify-center z-50 p-4" x-cloak>

        <div @click.away="closeAddCandidateModal()"
            class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fadeIn overflow-hidden">
            <div class="p-6 gradient-primary flex justify-between items-center">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <i data-lucide="user-plus" class="w-6 h-6 mr-3"></i>
                    Tambah Kandidat Baru
                </h3>
                <button @click="closeAddCandidateModal()"
                    class="text-white/70 hover:text-white transition-colors duration-200">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <form @submit.prevent="addCandidate()">
                <div class="p-8 space-y-5">
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Nama Kandidat</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3.5 pointer-events-none">
                                <i data-lucide="user-circle" class="w-5 h-5 text-gray-400"></i>
                            </div>
                            <input type="text" x-model="candidateForm.nama" required
                                class="w-full pl-11 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                placeholder="Cth: Dr. H. Budi Santoso">
                        </div>
                    </div>


                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Deskripsi & Visi Misi</label>
                        <div class="relative">
                            <div class="absolute top-3.5 left-0 flex items-start pl-3.5 pointer-events-none">
                                <i data-lucide="file-text" class="w-5 h-5 text-gray-400"></i>
                            </div>
                            <textarea x-model="candidateForm.deskripsi" required rows="3"
                                class="w-full pl-11 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition resize-none"
                                placeholder="Jelaskan visi, misi, dan program kerja..."></textarea>
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Foto Kandidat (Opsional)</label>
                        <div x-show="!isUploading" class="relative flex items-center justify-center w-full">
                            <label for="foto-upload"
                                class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
                                <div class="flex flex-col items-center justify-center">
                                    <i data-lucide="upload-cloud" class="w-8 h-8 mb-2 text-gray-400"></i>
                                    <p class="text-sm text-gray-500"><span class="font-semibold">Klik untuk
                                            upload</span></p>
                                    <p class="text-xs text-gray-400 mt-1">PNG atau JPG (Rasio 4:3)</p>
                                </div>
                                <input id="foto-upload" @change="handleFileUpload($event)" type="file" class="hidden"
                                    accept="image/png, image/jpeg" />
                            </label>
                        </div>
                        <div x-show="isUploading" class="p-4 border rounded-lg" x-cloak>
                            <div class="flex items-center justify-between mb-2">
                                <p class="text-sm font-medium text-gray-700 truncate" x-text="uploadFileName"></p>
                                <p class="text-sm font-bold text-blue-600" x-text="`${uploadProgress}%`"></p>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2.5 rounded-full transition-all duration-500"
                                    :style="`width: ${uploadProgress}%`"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="px-8 pb-8 pt-2">
                    <button type="submit" :disabled="loading"
                        class="w-full btn-primary text-white py-3 px-6 rounded-lg font-bold flex
items-center justify-center disabled:opacity-60 disabled:pointer-events-none transition-all duration-300 transform hover:scale-105">

                        <span x-show="!loading" class="flex items-center">
                            <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>
                            Tambah Kandidat
                        </span>
                        <span x-show="loading" class="flex items-center">
                            <div
                                class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2">
                            </div>
                            Menambahkan...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="showEditCandidate" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4"
        x-cloak>
        <div @click.away="closeEditCandidateModal()"
            class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fadeIn overflow-hidden">
            <div class="p-6 gradient-primary flex justify-between items-center">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <i data-lucide="edit-3" class="w-6 h-6 mr-3"></i>
                    Edit Data Kandidat
                </h3>
                <button @click="closeEditCandidateModal()"
                    class="text-white/70 hover:text-white transition-colors duration-200">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <form @submit.prevent="updateCandidate()">
                <div class="p-8 space-y-5">
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Nama Kandidat</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 flex items-center pl-3.5 pointer-events-none">
                                <i data-lucide="user-circle" class="w-5 h-5 text-gray-400"></i>
                            </div>
                            <input type="text" x-model="editCandidateForm.nama" required
                                class="w-full pl-11 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                placeholder="Cth: Dr. H. Budi Santoso">
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Deskripsi & Visi Misi</label>
                        <div class="relative">
                            <div class="absolute top-3.5 left-0 flex items-start pl-3.5 pointer-events-none">
                                <i data-lucide="file-text" class="w-5 h-5 text-gray-400"></i>
                            </div>
                            <textarea x-model="editCandidateForm.deskripsi" required rows="3"
                                class="w-full pl-11 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition resize-none"
                                placeholder="Jelaskan visi, misi, dan program kerja..."></textarea>
                        </div>
                    </div>


                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Foto Kandidat</label>
                        <div class="flex items-center space-x-4">
                            <img :src="editCandidateForm.foto || 'https://via.placeholder.com/60x60'"
                                class="w-16 h-16 rounded-lg object-cover border">
                            <p class="text-xs text-gray-500">Fitur untuk mengubah foto saat mengedit dapat ditambahkan
                                di pengembangan selanjutnya. Saat ini, foto akan tetap sama.</p>
                        </div>
                    </div>
                </div>

                <div class="px-8 pb-8 pt-2">
                    <button type="submit" :disabled="loading"
                        class="w-full btn-primary text-white py-3 px-6 rounded-lg font-bold flex items-center justify-center disabled:opacity-60 disabled:pointer-events-none transition-all duration-300 transform hover:scale-105">
                        <span x-show="!loading" class="flex items-center">
                            <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                            Simpan Perubahan
                        </span>
                        <span x-show="loading" class="flex items-center">
                            <div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2">
                            </div>
                            Menyimpan...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="showAddUser" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4"
        x-cloak>
        <div @click.away="closeAddUserModal()"
            class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fadeIn overflow-hidden">
            <div class="p-6 gradient-primary flex justify-between items-center">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <i data-lucide="user-plus" class="w-6 h-6 mr-3"></i>
                    Tambah Pengguna Baru
                </h3>
                <button @click="closeAddUserModal()"
                    class="text-white/70 hover:text-white transition-colors duration-200">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <form @submit.prevent="addUser()">
                <div class="p-8 space-y-5">
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Alamat Email</label>
                        <input type="email" x-model="userForm.email" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="contoh@email.com">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Password</label>
                        <input type="password" x-model="userForm.password" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="••••••••">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Role</label>
                        <select x-model="userForm.role"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white">
                            <option value="voter">Voter</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <div class="px-8 pb-8 pt-2">
                    <button type="submit" :disabled="loading"
                        class="w-full btn-primary text-white py-3 rounded-lg font-bold flex items-center justify-center disabled:opacity-60">
                        <span x-show="!loading">Tambah Pengguna</span>
                        <span x-show="loading">Menambahkan...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="showEditUser" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4"
        x-cloak>
        <div @click.away="closeEditUserModal()"
            class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fadeIn overflow-hidden">
            <div class="p-6 gradient-primary flex justify-between items-center">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <i data-lucide="user-cog" class="w-6 h-6 mr-3"></i>
                    Edit Pengguna
                </h3>
                <button @click="closeEditUserModal()"
                    class="text-white/70 hover:text-white transition-colors duration-200">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <form @submit.prevent="updateUser()">
                <div class="p-8 space-y-5">
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Alamat Email</label>
                        <input type="email" x-model="editUserForm.email" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="contoh@email.com">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Password Baru (Opsional)</label>
                        <input type="password" x-model="editUserForm.newPassword"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="Kosongkan jika tidak ingin ganti">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Role</label>
                        <select x-model="editUserForm.role" :disabled="editUserForm.originalEmail === user.email"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white disabled:bg-gray-100 disabled:cursor-not-allowed">
                            <option value="voter">Voter</option>
                            <option value="admin">Admin</option>
                        </select>
                        <p x-show="editUserForm.originalEmail === user.email" class="text-xs text-gray-500 mt-1">Anda
                            tidak dapat mengubah role akun Anda sendiri.</p>
                    </div>
                </div>
                <div class="px-8 pb-8 pt-2">
                    <button type="submit" :disabled="loading"
                        class="w-full btn-primary text-white py-3 rounded-lg font-bold flex items-center justify-center disabled:opacity-60">
                        <span x-show="!loading">Simpan Perubahan</span>
                        <span x-show="loading">Menyimpan...</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div x-show="showChangePasswordModal"
        class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4" x-cloak>
        <div @click.away="closeChangePasswordModal()"
            class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-fadeIn overflow-hidden">
            <div class="p-6 gradient-dark flex justify-between items-center">
                <h3 class="text-xl font-bold text-white flex items-center">
                    <i data-lucide="key" class="w-6 h-6 mr-3"></i>
                    Ganti Password Anda
                </h3>
                <button @click="closeChangePasswordModal()"
                    class="text-white/70 hover:text-white transition-colors duration-200">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <form @submit.prevent="changePassword()">
                <div class="p-8 space-y-5">
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Password Saat Ini</label>
                        <input type="password" x-model="changePasswordForm.current" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="••••••••">
                        <div class="text-right mt-2">
                            <button type="button" @click="forgotCurrentPassword()" class="text-sm text-blue-600 hover:text-blue-800 hover:underline focus:outline-none transition-colors duration-200">
                                Lupa password saat ini?
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Password Baru</label>
                        <input type="password" x-model="changePasswordForm.new" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="••••••••">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-semibold mb-2">Konfirmasi Password Baru</label>
                        <input type="password" x-model="changePasswordForm.confirm" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                            placeholder="••••••••">
                    </div>
                </div>
                <div class="px-8 pb-8 pt-2">
                    <button type="submit" :disabled="loading"
                        class="w-full btn-primary text-white py-3 rounded-lg font-bold flex items-center justify-center disabled:opacity-60">
                        <span x-show="!loading" class="flex items-center">
                            <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                            Simpan Password Baru
                        </span>
                        <span x-show="loading" class="flex items-center">
                            <div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2">
                            </div>
                            Menyimpan...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>


    <script>
        function votingApp() {
            return {
                currentPage: 'landing',
                activeSection: 'dashboard',
                isSidebarOpen: false,
                loading: false,
                loginError: '',
                showAddCandidate: false,

                // STATE BARU UNTUK FITUR EDIT
                showEditCandidate: false, // Mengontrol visibilitas modal edit
                editCandidateForm: { // Menampung data kandidat yang sedang diedit
                    id: null,
                    nama: '',
                    deskripsi: '',
                    foto: ''
                },

                // State untuk kelola pengguna
                showAddUser: false,
                showEditUser: false,
                userForm: {
                    email: '',
                    password: '',
                    role: 'voter'
                },
                editUserForm: {
                    originalEmail: '', // [PENTING] Menyimpan email asli untuk pencarian
                    email: '',
                    role: '',
                    newPassword: ''
                },

                // [BARU] State untuk modal ganti password
                showChangePasswordModal: false,
                changePasswordForm: {
                    current: '',
                    new: '',
                    confirm: ''
                },

                isUploading: false,
                uploadProgress: 0,
                uploadFileName: '',
                user: {
                    email: '',
                    role: ''
                },

                loginForm: {
                    email: '',
                    password: ''
                },
                candidateForm: {
                    nama: '',
                    deskripsi: '',
                    foto: ''
                },
                candidates: [],
                votes: [],
                users: [],
                userHasVoted: false,
                votingResults: [],

                pieChartStyle() {
                    if (this.votes.length === 0) {
                        return { background: '#f3f4f6' }; // Warna abu-abu jika tidak ada suara
                    }
                    const colors = ['#22c55e', '#3b82f6', '#8b5cf6', '#6b7280', '#ec4899'];
                    let cumulativePercent = 0;
                    const gradientStops = this.votingResults.map((result, index) => {
                        const stop = `${colors[index % colors.length]} ${cumulativePercent}% ${cumulativePercent + result.percentage}%`;
                        cumulativePercent += result.percentage;
                        return stop;
                    }).join(', ');
                    return { background: `conic-gradient(${gradientStops})` };
                },

                callApi(functionName, ...args) {
                    this.loading = true;
                    return new Promise((resolve, reject) => {
                        google.script.run
                            .withSuccessHandler(response => {
                                this.loading = false;

                                if (response && response.success === false) {
                                    console.error('Server-side operation failed:', response.message);
                                    Swal.fire('Error', response.message, 'error');
                                    reject(new Error(response.message));
                                } else {
                                    resolve(response);
                                }
                            })
                            .withFailureHandler(error => {
                                this.loading = false;
                                console.error('Google Script Run Error:', error);
                                Swal.fire('Error Kritis', `Terjadi kesalahan komunikasi dengan server: ${error.message}`, 'error');
                                if (this.currentPage === 'dashboard') this.logout();
                                reject(error);
                            })[functionName](...args);
                    });
                },

                formatDate(date) {
                    if (!date) return '-';
                    const options = {
                        weekday: 'long',
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    };
                    return new Date(date).toLocaleDateString('id-ID', options);
                },

                formatTimeAgo(date) {
                    if (!date) return '-';
                    const now = new Date();
                    const diffMs = now - new Date(date);
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    if (diffMins < 1) return 'Baru saja';
                    if (diffMins < 60) return `${diffMins} menit lalu`;
                    if (diffHours < 24) return `${diffHours} jam lalu`;
                    return `${diffDays} hari lalu`;
                },

                async loadAllData() {
                    try {
                        const [candidatesResult, votesResult, usersResult] = await Promise.all([
                            this.callApi('getCandidates'),
                            this.callApi('getVotes'),
                            this.callApi('getUsers')
                        ]);
                        this.candidates = candidatesResult.data || [];
                        this.votes = votesResult.data || [];
                        this.users = usersResult.data || [];
                        this.checkUserVoted();
                        this.calculateResults();
                        this.$nextTick(() => {
                            lucide.createIcons();
                        });
                    } catch (error) {
                        console.error("Gagal memuat semua data:", error);
                    }
                },


                async login() {
                    this.loginError = '';
                    try {
                        const result = await this.callApi('handleLogin', this.loginForm.email, this.loginForm.password);
                        if (result.success) {
                            this.user = result.user;
                            localStorage.setItem('votingUser', JSON.stringify(this.user));
                            this.currentPage = 'dashboard';
                            await this.loadAllData();
                        } else {
                            this.loginError = result.message || 'Email atau password salah!';

                        }
                    } catch (error) {
                        this.loginError = error.message;
                    }
                },

                logout() {
                    localStorage.removeItem('votingUser');
                    this.user = {
                        email: '',
                        role: ''
                    };
                    this.currentPage = 'landing';
                    this.activeSection = 'dashboard';
                    this.loginForm = {
                        email: '',
                        password: ''
                    };
                    this.userHasVoted = false;
                    this.candidates = [];
                    this.votes = [];
                    this.users = [];
                },

                checkUserVoted() {
                    this.userHasVoted = this.votes.some(vote => vote.email === this.user.email);
                },

                async vote(candidateId) {
                    if (this.userHasVoted) {
                        Swal.fire('Sudah Memilih', 'Anda sudah melakukan voting sebelumnya!', 'info');
                        return;
                    }

                    Swal.fire({
                        title: 'Konfirmasi Pilihan Anda',
                        html: "Pilihan Anda akan direkam secara permanen dan <strong>tidak dapat diubah</strong>. Lanjutkan?",
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#667eea',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Ya, Saya Yakin!',
                        cancelButtonText: 'Batal',
                        reverseButtons: true
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const voteResult = await this.callApi('submitVote', this.user.email, candidateId);
                                if (voteResult.success) {
                                    const votesResult =
                                        await this.callApi('getVotes');
                                    this.votes = votesResult.data;
                                    this.checkUserVoted();
                                    this.calculateResults();
                                    Swal.fire(
                                        'Voting Berhasil!',
                                        'Terima kasih atas partisipasi Anda dalam pemilihan ini.',
                                        'success'
                                    );
                                }
                            } catch (error) {
                                // Error sudah ditangani di callApi
                            }
                        }
                    });
                },

                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (!file) return;

                    this.uploadFileName = file.name;
                    this.isUploading = true;
                    this.uploadProgress = 0;
                    const interval = setInterval(() => {
                        if (this.uploadProgress < 100) {
                            this.uploadProgress += 10;
                        } else {
                            clearInterval(interval);
                        }
                    }, 50);
                },

                closeAddCandidateModal() {
                    this.showAddCandidate = false;
                    this.candidateForm = {
                        nama: '',
                        deskripsi: '',
                        foto: ''
                    };
                    document.getElementById('foto-upload').value = '';
                    this.isUploading = false;
                    this.uploadProgress = 0;
                    this.uploadFileName = '';
                },

                openEditModal(candidate) {
                    this.editCandidateForm = { ...candidate
                    };
                    this.showEditCandidate = true;
                },

                closeEditCandidateModal() {
                    this.showEditCandidate = false;
                    this.editCandidateForm = {
                        id: null,
                        nama: '',
                        deskripsi: '',
                        foto: ''
                    };
                },

                async updateCandidate() {
                    if (!this.editCandidateForm.nama.trim() || !this.editCandidateForm.deskripsi.trim()) {
                        Swal.fire('Data Tidak Lengkap', 'Nama dan Deskripsi tidak boleh kosong.', 'error');
                        return;
                    }
                    try {
                        const result = await this.callApi('updateCandidate', this.editCandidateForm);
                        if (result.success) {
                            await this.loadAllData();
                            this.closeEditCandidateModal();
                            Swal.fire('Berhasil!', 'Data kandidat telah diperbarui.', 'success');
                        }
                    } catch (error) {
                        // Error sudah ditangani oleh fungsi callApi
                    }
                },

                async addCandidate() {
                    if (!this.candidateForm.nama.trim() || !this.candidateForm.deskripsi.trim()) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Data Tidak Lengkap',
                            text: 'Mohon pastikan Nama dan Deskripsi Kandidat telah diisi dengan benar.',
                            confirmButtonColor: '#764ba2'
                        });
                        return;
                    }

                    const fileInput = document.getElementById('foto-upload');
                    const file = fileInput.files[0];
                    let fileData = null;

                    const processAndSend = async (fileDataPayload) => {
                        try {
                            const result = await this.callApi('addCandidate', this.candidateForm.nama, this.candidateForm.deskripsi, fileDataPayload);
                            if (result.success) {
                                const candidatesResult = await this.callApi('getCandidates');
                                this.candidates = candidatesResult.data;
                                this.closeAddCandidateModal();
                                this.calculateResults();
                                Swal.fire('Berhasil', 'Kandidat baru berhasil ditambahkan!', 'success');
                            }
                        } catch (error) {
                            // Error sudah ditangani di callApi
                        }
                    };
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const base64Data = e.target.result.split(',')[1];
                            fileData = {
                                base64Data: base64Data,
                                mimeType: file.type,
                                fileName: file.name
                            };
                            processAndSend(fileData);
                        };
                        reader.readAsDataURL(file);
                    } else {
                        processAndSend(null);
                    }
                },

                async deleteCandidate(candidateId) {
                    const candidate = this.candidates.find(c => c.id === candidateId);
                    if (!candidate) return;

                    Swal.fire({
                        title: 'Anda Yakin?',
                        html: `Anda akan menghapus kandidat <strong>${candidate.nama}</strong>. <br><br> Tindakan ini akan menghapus semua suara terkait dan tidak dapat dibatalkan.`,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#e11d48',
                        cancelButtonColor: '#3b82f6',
                        confirmButtonText: 'Ya, Hapus Saja!',
                        cancelButtonText: 'Jangan, Batalkan'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const deleteResult = await
                                this.callApi('deleteCandidate', candidateId);

                                if (deleteResult.success) {
                                    await this.loadAllData();
                                    Swal.fire(
                                        'Terhapus!',
                                        `Kandidat ${candidate.nama} berhasil dihapus.`,
                                        'success'
                                    );
                                }
                            } catch (error) {
                                // Error sudah ditangani di callApi
                            }
                        }
                    });
                },

                // Fungsi untuk Kelola Pengguna
                openAddUserModal() {
                    this.showAddUser = true;
                },
                closeAddUserModal() {
                    this.showAddUser = false;
                    this.userForm = {
                        email: '',
                        password: '',
                        role: 'voter'
                    };
                },
                async addUser() {
                    if (!this.userForm.email.trim() || !this.userForm.password.trim()) {
                        Swal.fire('Data Tidak Lengkap', 'Email dan Password wajib diisi.', 'error');
                        return;
                    }
                    try {
                        const result = await this.callApi('addUser', this.userForm.email, this.userForm.password, this.userForm.role);
                        if (result.success) {
                            await this.loadAllData();
                            this.closeAddUserModal();
                            Swal.fire('Berhasil!', 'Pengguna baru telah ditambahkan.', 'success');
                        }
                    } catch (error) { /* Ditangani oleh callApi */ }
                },
                openEditUserModal(userToEdit) {
                    this.editUserForm.originalEmail = userToEdit.email; // Simpan email asli
                    this.editUserForm.email = userToEdit.email;
                    this.editUserForm.role = userToEdit.role;
                    this.editUserForm.newPassword = '';
                    this.showEditUser = true;
                },
                closeEditUserModal() {
                    this.showEditUser = false;
                },
                async updateUser() {
                    try {
                        // PERUBAHAN: Kirim objek `editUserForm` secara keseluruhan
                        const result = await this.callApi('updateUser', this.editUserForm);
                        if (result.success) {
                            // Jika admin mengedit akunnya sendiri, update sesi lokal
                            if (this.editUserForm.originalEmail === this.user.email) {
                                this.user.email = this.editUserForm.email;
                                localStorage.setItem('votingUser', JSON.stringify(this.user));
                            }
                            await this.loadAllData();
                            this.closeEditUserModal();
                            Swal.fire('Berhasil!', 'Data pengguna telah diperbarui.', 'success');
                        }
                    } catch (error) { /* Ditangani oleh callApi */ }
                },
                deleteUser(email) {
                    if (email === this.user.email) {
                        Swal.fire('Aksi Ditolak', 'Anda tidak dapat menghapus akun Anda sendiri.', 'error');
                        return;
                    }
                    Swal.fire({
                        title: 'Hapus Pengguna Ini?',
                        html: `Anda akan menghapus <strong>${email}</strong>. <br><br> Semua data voting terkait pengguna ini juga akan dihapus.`,
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#e11d48',
                        confirmButtonText: 'Ya, Hapus!',
                        cancelButtonText: 'Batal'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const deleteResult = await this.callApi('deleteUser', email);
                                if (deleteResult.success) {
                                    await this.loadAllData();
                                    Swal.fire('Terhapus!', `Pengguna ${email} telah dihapus.`, 'success');
                                }
                            } catch (error) { /* Ditangani oleh callApi */ }
                        }
                    });
                },

                // [BARU] Fungsi untuk Ganti Password
                openChangePasswordModal() {
                    this.changePasswordForm = {
                        current: '',
                        new: '',
                        confirm: ''
                    };
                    this.showChangePasswordModal = true;
                },
                closeChangePasswordModal() {
                    this.showChangePasswordModal = false;
                },
                async changePassword() {
                    if (!this.changePasswordForm.current || !this.changePasswordForm.new) {
                        Swal.fire('Data Tidak Lengkap', 'Semua field wajib diisi.', 'warning');
                        return;
                    }
                    if (this.changePasswordForm.new !== this.changePasswordForm.confirm) {
                        Swal.fire('Password Tidak Cocok', 'Password baru dan konfirmasi tidak sama.', 'error');
                        return;
                    }

                    try {
                        const result = await this.callApi('changePassword', this.user.email, this.changePasswordForm.current, this.changePasswordForm.new);
                        if (result.success) {
                            this.closeChangePasswordModal();
                            Swal.fire('Berhasil!', 'Password Anda telah berhasil diubah.', 'success');
                        }
                    } catch (error) {
                        // error sudah ditangani callApi
                    }
                },

                // [FUNGSI BARU] Untuk mengirim password saat ini ke email
                async forgotCurrentPassword() {
                    Swal.fire({
                        title: 'Kirim Password ke Email?',
                        html: `Kami akan mengirimkan password Anda saat ini ke email <strong>${this.user.email}</strong>. Lanjutkan?`,
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonColor: '#667eea',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Ya, Kirimkan!',
                        cancelButtonText: 'Batal'
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const apiResult = await this.callApi('sendCurrentPasswordToEmail', this.user.email);
                                if (apiResult.success) {
                                    Swal.fire(
                                        'Terkirim!',
                                        'Password Anda telah dikirim. Silakan periksa kotak masuk email Anda.',
                                        'success'
                                    );
                                }
                                // Jika gagal, error akan ditangani oleh callApi
                            } catch (error) {
                                // Error sudah ditangani
                            }
                        }
                    });
                },

                showSuccessReset() {
                    Swal.fire({
                        position: 'top-end',
                        icon: 'success',
                        title: 'Semua Data Voting Telah Direset',
                        showConfirmButton: false,
                        timer: 2000,
                        timerProgressBar: true,
                        toast: true
                    });
                },

                async resetVotes() {
                    Swal.fire({
                        title: 'RESET SEMUA DATA VOTING?',
                        html: "Tindakan ini bersifat <strong>permanen</strong> dan akan menghapus semua rekam jejak suara. <br><br> Ketik <strong>RESET</strong> di bawah untuk konfirmasi.",
                        icon: 'warning',
                        input: 'text',
                        inputPlaceholder: 'Ketik RESET di sini',
                        inputAttributes: {
                            autocapitalize: 'off',
                            autocorrect: 'off'
                        },
                        showCancelButton: true,
                        confirmButtonText: 'Lanjutkan Reset',
                        confirmButtonColor: '#e11d48',
                        cancelButtonText: 'Batalkan',
                        showLoaderOnConfirm: true,
                        preConfirm: (inputValue) => {
                            if (inputValue !== 'RESET') {
                                Swal.showValidationMessage(
                                    'Konfirmasi salah! Ketik "RESET" dengan benar.'
                                );
                                return false;
                            }
                            return inputValue;
                        },
                        allowOutsideClick: () => !Swal.isLoading()
                    }).then(async (result) => {
                        if (result.isConfirmed) {
                            try {
                                const apiResult =
                                    await this.callApi('resetAllVotes');
                                if (apiResult.success) {
                                    this.votes = [];
                                    this.userHasVoted = false;
                                    this.calculateResults();
                                    this.showSuccessReset();
                                }
                            } catch (error) {
                                // Error sudah ditangani di callApi
                            }
                        }
                    });
                },

                calculateResults() {
                    const results = [];
                    const totalVotes = this.votes.length;
                    this.candidates.forEach(candidate => {
                        const candidateVotes = this.votes.filter(v => v.candidateId == candidate.id).length;
                        const percentage = totalVotes > 0 ? Math.round((candidateVotes / totalVotes) * 100) : 0;
                        results.push({
                            id: candidate.id,
                            nama: candidate.nama,
                            votes: candidateVotes,
                            percentage: percentage
                        });
                    });
                    this.votingResults = results.sort((a, b) => b.votes - a.votes);
                },

                init() {
                    try {
                        const savedUser = localStorage.getItem('votingUser');
                        if (savedUser) {
                            console.log("Sesi ditemukan, mencoba login otomatis...");
                            this.user = JSON.parse(savedUser);
                            this.currentPage = 'dashboard';
                            this.loadAllData();
                        } else {
                            console.log("Tidak ada sesi, tampilkan halaman landing.");
                        }
                    } catch (error) {
                        console.error("Gagal memuat sesi dari localStorage:", error);
                        localStorage.removeItem('votingUser');
                    }

                    lucide.createIcons();
                    console.log("Voting App Initialized");
                }
            }
        }
    </script>
</body>
</html>